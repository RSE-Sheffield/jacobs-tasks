<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-canvas-button-response.js"></script>
    <script src="jspsych/plugin-call-function.js"></script>
    <script src="config/expt2_config.js"></script>
    <script src="functions/expt2_func.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />

    <style>
      .colour-btn {
          font-size: 30px;
          padding: 10px 20px;
      }

      .colour-btn-yes {
          background-color: lightgreen;
      }

      .colour-btn-no {
          background-color: lightsalmon;
      }
      
      </style>
  </head>

  <body>
    <canvas id="canvas" width="600" height="600">
    </canvas>

    <script>
        const jsPsych = initJsPsych({
          on_finish: function() {
            const d = new Date();
            var filename = d.toISOString() + "_expt2_testdata.csv"
            jsPsych.data.get().localSave('csv', filename);
          }
        });
      const canvas = document.getElementById("canvas");

      const imgSize = 96;
      const canvasCentre = [canvas.width/2 - imgSize/2, canvas.height/2 - imgSize/2];
      const positionArr = [1, 2, 3, 4, 5, 6, 7, 8];
      
      let stimArray;
      let jspShuffle = jsPsych.randomization.shuffle
      let allStims = Array.from({length: 454}, (value, index) => index + 1)
      allStims = jspShuffle(allStims)

        var timeline = [];

      // Standard fixation object
      var fixation = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '<div style="font-size:60px;">+</div>',
        choices: "NO_KEYS",
        trial_duration: 1000, //config.fixationDuration,
        data: {
          screen: 'fixation'
        }
      };

      timeline.push(fixation);

      var memory_array = {
        type: jsPsychCanvasButtonResponse,
        on_start: function(trial){
          stimArray = generateStims(nStims);
        },
        stimulus: function(c) {
          // pass the array to the draw images function
          drawImages(c, stimArray);
        },
        canvas_size: [canvas.width, canvas.height],
        choices: [],
        trial_duration: 3000, //config.fixationDuration,
        data: {
          screen: 'memory_array'
        },
      };

      timeline.push(memory_array);

      var response_screen = {
        type: jsPsychCanvasButtonResponse,
        on_start: function(trial) {
          probe = generateProbe(probe_present);
        },
        stimulus: function(c) {
          const ctx = c.getContext("2d");
          ctx.translate(...canvasCentre);
          probe.drawImage(ctx)
        },
        canvas_size: [canvas.width, canvas.height],
        choices: ["Yes - Sure", "Yes - Think", "Yes - Guess",
                  "No - Sure", "No - Think", "No - Guess"],
        button_html: [
          '<button class="jspsych-btn colour-btn colour-btn-yes">%choice%</button>',
          '<button class="jspsych-btn colour-btn colour-btn-yes">%choice%</button>',
          '<button class="jspsych-btn colour-btn colour-btn-yes">%choice%</button>',
          '<button class="jspsych-btn colour-btn colour-btn-no">%choice%</button>',
          '<button class="jspsych-btn colour-btn colour-btn-no">%choice%</button>',
          '<button class="jspsych-btn colour-btn colour-btn-no">%choice%</button>',
        ],
        data: {
          screen: 'probe'
        },
      };

    </script>

  </body>

</html>